{"version":3,"file":"manage_courses.min.js","sources":["../src/manage_courses.js"],"sourcesContent":["import * as notification from 'core/notification';\nimport * as Str from 'core/str';\nimport * as Ajax from 'core/ajax';\n\nexport const init = (learningplanid) => {\n    deleteCourseAction(learningplanid);\n    addCoursePeriodAction(learningplanid);\n    addRequiredAction(learningplanid);\n    addOptionalAction(learningplanid);\n    changeOptionalToRequiredAction(learningplanid);\n\n    updateCoursePositionAction();\n};\n\nlet deleteCourseAction = (learningplanid) => {\n    const deleteBtns = document.querySelectorAll('#btndeletecourse');\n    if (deleteBtns) {\n        for (const el of deleteBtns) {\n            el.addEventListener('click', e => {\n                e.preventDefault();\n                const courseid = e.target.parentElement.getAttribute('course-id');\n                const isrequired = e.target.parentElement.getAttribute('course-required');\n                const titleconfirm = Str.get_string('titleconfirm', 'local_sc_learningplans');\n                const msgconfirm = Str.get_string('msgconfirm_course', 'local_sc_learningplans');\n                const yesconfirm = Str.get_string('yesconfirm', 'local_sc_learningplans');\n                notification.saveCancel(titleconfirm, msgconfirm, yesconfirm, () => {\n                    callDeleteCourse(learningplanid, courseid, isrequired);\n                });\n            });\n        }\n    }\n};\n\nlet addCoursePeriodAction = (learningplanid) => {\n    const btnaddcourses = document.querySelector('#addcourses');\n    if (btnaddcourses) {\n        btnaddcourses.addEventListener('click', e => {\n            e.preventDefault();\n            const courseselected = document.getElementById('selectAddCourseToLearningPlanPeriod').selectedOptions;\n            const periodselected = document.getElementById('selectPeriodToLearningPlan').value;\n            const creditselected = document.getElementById('selectCredits').value;\n            let typecourse = 0;\n            if (document.getElementById('required').checked) {\n                typecourse = 1;\n            } else if (document.getElementById('optional').checked) {\n                typecourse = 0;\n            }\n            if (courseselected) {\n                const datacourses = Array.prototype.slice.call(courseselected);\n                const courseid = datacourses.map(select => {\n                    return select.value;\n                }).join(',');\n                callAddCourse(learningplanid, periodselected, courseid, typecourse, creditselected);\n            }\n        });\n    }\n};\n\nlet addRequiredAction = (learningplanid) => {\n    const btnaddrequired = document.querySelector('#addrequired');\n    if (btnaddrequired) {\n        btnaddrequired.addEventListener('click', e => {\n            e.preventDefault();\n            const courseselected = document.getElementById('selectAddCourseToLearningPlan').selectedOptions;\n            if (courseselected) {\n                const datacourses = Array.prototype.slice.call(courseselected);\n                const courseid = datacourses.map(select => select.value).join(',');\n                callAddCourse(learningplanid, -1, courseid, 1, -1);\n            }\n        });\n    }\n};\n\nlet addOptionalAction = (learningplanid) => {\n    const btnaddooptional = document.querySelector('#addOptional');\n    if (btnaddooptional) {\n        btnaddooptional.addEventListener('click', e => {\n            e.preventDefault();\n            const courseselected = document.getElementById('selectAddCourseOptionalToLearningPlan').selectedOptions;\n            if (courseselected) {\n                const datacourses = Array.prototype.slice.call(courseselected);\n                const courseid = datacourses.map(select => select.value).join(',');\n                callAddCourse(learningplanid, -1, courseid, 0, -1);\n            }\n        });\n    }\n};\n\nlet changeOptionalToRequiredAction = (learningplanid) => {\n    const addoptionalrequired = document.querySelectorAll('#addoptional_required');\n    if (addoptionalrequired) {\n        for (const add of addoptionalrequired) {\n            add.addEventListener('click', e => {\n                e.preventDefault();\n                const addcourserequired = e.target.getAttribute('cid');\n                const coursename = e.target.getAttribute('cname');\n                if (addcourserequired) {\n                    const courseid = addcourserequired;\n                    const titleconfirm = Str.get_string('titleconfirmmove', 'local_sc_learningplans');\n                    const msgconfirm = Str.get_string('msgconfirm_mmove', 'local_sc_learningplans', { cname: coursename });\n                    const yesconfirm = Str.get_string('yesmmoveconfirm', 'local_sc_learningplans');\n                    notification.saveCancel(titleconfirm, msgconfirm, yesconfirm, () => {\n                        callDeleteCourse(learningplanid, courseid, 0);\n                        callAddCourse(learningplanid, courseid, 1);\n                    });\n                }\n            });\n        }\n    }\n};\n\n\nconst callUpdateCourse = (learningid, courseorder) => {\n    learningid = parseInt(learningid);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_update_required_learning_courses',\n        args: {\n            learningplan: learningid,\n            courseorder,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_update_required_learning_courses', response);\n        location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nconst callAddCourse = (learningid, periodid, courseid, isrequired, credits) => {\n    learningid = parseInt(learningid);\n    courseid = parseInt(courseid);\n    isrequired = parseInt(isrequired);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_save_learning_course',\n        args: {\n            learningplan: learningid,\n            periodid: periodid,\n            courseid,\n            required: isrequired,\n            credits: credits,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_save_learning_course', response);\n        location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nconst callDeleteCourse = (learningid, courseid, isrequired) => {\n    learningid = parseInt(learningid);\n    courseid = parseInt(courseid);\n    isrequired = parseInt(isrequired);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_delete_learning_course',\n        args: {\n            learningplan: learningid,\n            courseid,\n            required: isrequired,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_delete_learning_course', response);\n        location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nlet items = document.querySelectorAll('.list-courses-required');\nlet containercourses = document.querySelectorAll('.coursesrequired');\n\nconst updateCoursePositionAction = () => {\n    const btnupdatecourseorder = document.querySelector('#updatecourseorder');\n\n    items.forEach(function (item) {\n        item.addEventListener('dragstart', handleDragStart, false);\n        item.addEventListener('dragenter', handleDragEnter, false);\n        item.addEventListener('dragover', handleDragOver, false);\n        item.addEventListener('dragleave', handleDragLeave, false);\n        item.addEventListener('drop', handleDrop, false);\n        item.addEventListener('dragend', handleDragEnd, false);\n    });\n\n    containercourses.forEach(function (contelement) {\n        contelement.addEventListener('dragenter', handleDragEnter, false);\n        contelement.addEventListener('dragleave', handleDragLeave, false);\n        contelement.addEventListener('dragover', handleDragOver, false);\n        contelement.addEventListener('drop', handleDropNew, false);\n    });\n\n    if (btnupdatecourseorder) {\n        const lpid = document.querySelector(\".coursesrequired\");\n        let learningplanid = lpid.getAttribute('learningplanid');\n        btnupdatecourseorder.addEventListener('click', e => {\n            e.preventDefault();\n            const courseData = [];\n            items.forEach(function (item) {\n                let listCoursesid = item.attributes.datacourse.value;\n                let listCoursePosition = item.attributes.poscourse.value;\n                courseData.push({\n                    courseid: listCoursesid.replace('courses[', '').replace(']', ''),\n                    position: listCoursePosition,\n                });\n            });\n\n            const coursePosition = [];\n            courseData.forEach((index) => {\n                coursePosition.push({\n                    courseid: index.courseid,\n                    position: index.position,\n                    periodid: index.periodid\n                });\n            });\n            callUpdateCourse(learningplanid, coursePosition);\n        });\n    }\n};\n\nvar dragSrcEl = null;\n\n/**\n *\n * @param {*} e\n */\nfunction handleDragStart(e) {\n    this.style.opacity = '0.4';\n\n    dragSrcEl = this;\n\n    e.dataTransfer.effectAllowed = 'move';\n    e.dataTransfer.setData('text/html', this.innerHTML);\n}\n\n/**\n *\n * @param {*} e\n */\nfunction handleDragOver(e) {\n    if (e.preventDefault) {\n        e.preventDefault();\n    }\n\n    e.dataTransfer.dropEffect = 'move';\n\n    return false;\n}\n\n/**\n *\n */\nfunction handleDragEnter() {\n    this.classList.add('over');\n}\n\n/**\n *\n */\nfunction handleDragLeave() {\n    this.classList.remove('over');\n}\n\n/**\n *\n * @param {*} e\n */\nfunction handleDrop(e) {\n    if (e.stopPropagation) {\n        e.stopPropagation(); // stops the browser from redirecting.\n    }\n    if (dragSrcEl != this) {\n        dragSrcEl.innerHTML = this.innerHTML;\n        this.innerHTML = e.dataTransfer.getData('text/html');\n        let itemToReplaceAttr = this.attributes[\"datacourse\"].value;\n        let draggedItemAttr = dragSrcEl.attributes[\"datacourse\"].value;\n        this.setAttribute(\"datacourse\", draggedItemAttr);\n        dragSrcEl.setAttribute(\"datacourse\", itemToReplaceAttr);\n    }\n\n    return false;\n}\n\n/**\n *\n * @param {*} e\n */\nfunction handleDropNew(e) {\n    if (e.stopPropagation) {\n        e.stopPropagation(); // stops the browser from redirecting.\n    }\n    const dragParent = dragSrcEl.parentElement;\n    if (dragParent != e.target) {\n        e.target.append(dragSrcEl);\n    }\n    return false;\n}\n\n/**\n *\n */\nfunction handleDragEnd() {\n    this.style.opacity = '1';\n    items.forEach(function (item) {\n        item.classList.remove('over');\n    });\n    containercourses.forEach(function (item) {\n        item.classList.remove('over');\n    });\n}"],"names":["learningplanid","deleteCourseAction","addCoursePeriodAction","addRequiredAction","addOptionalAction","changeOptionalToRequiredAction","updateCoursePositionAction","deleteBtns","document","querySelectorAll","addEventListener","e","preventDefault","courseid","target","parentElement","getAttribute","isrequired","titleconfirm","Str","get_string","msgconfirm","yesconfirm","notification","saveCancel","callDeleteCourse","btnaddcourses","querySelector","courseselected","getElementById","selectedOptions","periodselected","value","creditselected","typecourse","checked","Array","prototype","slice","call","map","select","join","callAddCourse","btnaddrequired","btnaddooptional","addoptionalrequired","addcourserequired","coursename","cname","learningid","periodid","credits","parseInt","Ajax","methodname","args","learningplan","required","done","response","window","console","log","location","reload","fail","error","items","containercourses","btnupdatecourseorder","forEach","item","handleDragStart","handleDragEnter","handleDragOver","handleDragLeave","handleDrop","handleDragEnd","contelement","handleDropNew","courseData","listCoursesid","attributes","datacourse","listCoursePosition","poscourse","push","replace","position","courseorder","coursePosition","index","dragSrcEl","style","opacity","this","dataTransfer","effectAllowed","setData","innerHTML","dropEffect","classList","add","remove","stopPropagation","getData","itemToReplaceAttr","draggedItemAttr","setAttribute","append"],"mappings":"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"}