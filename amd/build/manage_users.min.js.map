{"version":3,"file":"manage_users.min.js","sources":["../src/manage_users.js"],"sourcesContent":["import * as notification from 'core/notification';\nimport * as Str from 'core/str';\nimport * as Ajax from 'core/ajax';\n\nexport const init = (learningplanid) => {\n    addUserAction(learningplanid);\n    deleteUserAction(learningplanid);\n    searchAction();\n};\nconst searchAction = () => {\n    window.console.log('searchAction');\n    const btn = document.querySelector('#searchBtn');\n    window.console.log('btn', btn);\n    if(!btn) {\n        return;\n    }\n    btn.addEventListener('click', () => {\n        const search = document.querySelector('#searchUser');\n        window.console.log('click', search);\n        if(!search) {\n            return;\n        }\n        var searchParams = new URLSearchParams(window.location.search);\n        searchParams.set(\"searchUser\", search.value);\n        window.location.search = searchParams.toString();\n    });\n};\n\nconst deleteUserAction = (learningplanid) => {\n    const deletebtn = document.querySelectorAll('.btn.deleteuser');\n    const titleconfirm = Str.get_string('titleconfirm', 'local_sc_learningplans');\n    const msgconfirm = Str.get_string('msgconfirm_user', 'local_sc_learningplans');\n    const yesconfirm = Str.get_string('yesconfirm', 'local_sc_learningplans');\n    deletebtn.forEach(el => {\n        el.addEventListener('click', e => {\n            e.preventDefault();\n            const userid = e.target.parentElement.getAttribute('userid');\n            notification.saveCancel(titleconfirm, msgconfirm, yesconfirm, () => {\n                const removeenrol = document.querySelector('#checkRemoveCourses');\n                window.console.log(removeenrol, removeenrol.checked);\n                callDeleteUser(learningplanid, userid, removeenrol ? removeenrol.checked : false);\n            });\n        });\n    });\n};\n\nconst addUserAction = (learningplanid) => {\n    const userselected = document.querySelector('#listusers');\n    const itemvalue = document.querySelector('#listusers-hidden');\n    const roleselected = document.querySelector('#listroles');\n    const groupselected = document.querySelector('#listgroups');\n    userselected.addEventListener('change', () => {\n        const val = userselected.value;\n        const userList = document.querySelector(`#users-list option[value='${val}']`);\n        if (userList) {\n            itemvalue.value = userList.getAttribute('data-id');\n        }\n    });\n\n    const btnadduser = document.querySelector('#adduser');\n    if (btnadduser) {\n        btnadduser.addEventListener('click', e => {\n            e.preventDefault();\n            if (userselected && roleselected) {\n                const userid = itemvalue.value;\n                const roleid = roleselected.value;\n                let group = null;\n                if(groupselected) {\n                    group = groupselected.value;\n                }\n                callAddUser(learningplanid, userid, roleid, group);\n            }\n        });\n    }\n};\n\nconst callDeleteUser = (learningplan, userid, unenrol) => {\n    learningplan = parseInt(learningplan);\n    userid = parseInt(userid);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_delete_learning_user',\n        args: {\n            learningplan,\n            userid,\n            unenrol,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_delete_learning_user', response);\n        window.location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nconst callAddUser = (learningplan, userid, roleid, group) => {\n    learningplan = parseInt(learningplan);\n    userid = parseInt(userid);\n    roleid = parseInt(roleid);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_add_learning_user',\n        args: {\n            learningplan,\n            userid,\n            roleid,\n            group,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_add_learning_user', response);\n        window.location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};"],"names":["learningplanid","addUserAction","deleteUserAction","searchAction","window","console","log","btn","document","querySelector","addEventListener","search","searchParams","URLSearchParams","location","set","value","toString","deletebtn","querySelectorAll","titleconfirm","Str","get_string","msgconfirm","yesconfirm","forEach","el","e","preventDefault","userid","target","parentElement","getAttribute","notification","saveCancel","removeenrol","checked","callDeleteUser","userselected","itemvalue","roleselected","groupselected","val","userList","btnadduser","roleid","group","callAddUser","learningplan","unenrol","parseInt","Ajax","call","methodname","args","done","response","reload","fail","error"],"mappings":"uxCAIqBA,iBACjBC,cAAcD,gBACdE,iBAAiBF,gBACjBG,sBAEEA,aAAe,KACjBC,OAAOC,QAAQC,IAAI,sBACbC,IAAMC,SAASC,cAAc,cACnCL,OAAOC,QAAQC,IAAI,MAAOC,KACtBA,KAGJA,IAAIG,iBAAiB,SAAS,WACpBC,OAASH,SAASC,cAAc,kBACtCL,OAAOC,QAAQC,IAAI,QAASK,QACxBA,YAGAC,aAAe,IAAIC,gBAAgBT,OAAOU,SAASH,QACvDC,aAAaG,IAAI,aAAcJ,OAAOK,OACtCZ,OAAOU,SAASH,OAASC,aAAaK,gBAIxCf,iBAAoBF,uBAChBkB,UAAYV,SAASW,iBAAiB,mBACtCC,aAAeC,IAAIC,WAAW,eAAgB,0BAC9CC,WAAaF,IAAIC,WAAW,kBAAmB,0BAC/CE,WAAaH,IAAIC,WAAW,aAAc,0BAChDJ,UAAUO,SAAQC,KACdA,GAAGhB,iBAAiB,SAASiB,IACzBA,EAAEC,uBACIC,OAASF,EAAEG,OAAOC,cAAcC,aAAa,UACnDC,aAAaC,WAAWd,aAAcG,WAAYC,YAAY,WACpDW,YAAc3B,SAASC,cAAc,uBAC3CL,OAAOC,QAAQC,IAAI6B,YAAaA,YAAYC,SAC5CC,eAAerC,eAAgB6B,SAAQM,aAAcA,YAAYC,mBAM3EnC,cAAiBD,uBACbsC,aAAe9B,SAASC,cAAc,cACtC8B,UAAY/B,SAASC,cAAc,qBACnC+B,aAAehC,SAASC,cAAc,cACtCgC,cAAgBjC,SAASC,cAAc,eAC7C6B,aAAa5B,iBAAiB,UAAU,WAC9BgC,IAAMJ,aAAatB,MACnB2B,SAAWnC,SAASC,cAAe,6BAA4BiC,SACjEC,WACAJ,UAAUvB,MAAQ2B,SAASX,aAAa,qBAI1CY,WAAapC,SAASC,cAAc,YACtCmC,YACAA,WAAWlC,iBAAiB,SAASiB,OACjCA,EAAEC,iBACEU,cAAgBE,aAAc,OACxBX,OAASU,UAAUvB,MACnB6B,OAASL,aAAaxB,UACxB8B,MAAQ,KACTL,gBACCK,MAAQL,cAAczB,OAE1B+B,YAAY/C,eAAgB6B,OAAQgB,OAAQC,YAMtDT,eAAiB,CAACW,aAAcnB,OAAQoB,WAC1CD,aAAeE,SAASF,cACxBnB,OAASqB,SAASrB,QACFsB,KAAKC,KAAK,CAAC,CACvBC,WAAY,8CACZC,KAAM,CACFN,aAAAA,aACAnB,OAAAA,OACAoB,QAAAA,YAIA,GAAGM,MAAK,SAAUC,UACtBpD,OAAOC,QAAQC,IAAI,8CAA+CkD,UAClEpD,OAAOU,SAAS2C,YACjBC,MAAK,SAAUF,UACdpD,OAAOC,QAAQsD,MAAMH,cAIvBT,YAAc,CAACC,aAAcnB,OAAQgB,OAAQC,SAC/CE,aAAeE,SAASF,cACxBnB,OAASqB,SAASrB,QAClBgB,OAASK,SAASL,QACFM,KAAKC,KAAK,CAAC,CACvBC,WAAY,2CACZC,KAAM,CACFN,aAAAA,aACAnB,OAAAA,OACAgB,OAAAA,OACAC,MAAAA,UAIA,GAAGS,MAAK,SAAUC,UACtBpD,OAAOC,QAAQC,IAAI,2CAA4CkD,UAC/DpD,OAAOU,SAAS2C,YACjBC,MAAK,SAAUF,UACdpD,OAAOC,QAAQsD,MAAMH"}