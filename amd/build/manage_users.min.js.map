{"version":3,"file":"manage_users.min.js","sources":["../src/manage_users.js"],"sourcesContent":["import * as notification from 'core/notification';\nimport * as Str from 'core/str';\nimport * as Ajax from 'core/ajax';\n\nexport const init = (learningplanid) => {\n    callGetUsers(learningplanid, 1, 5, null, true);\n\n    addUserAction(learningplanid);\n\n    const searchUsers = document.querySelector('#searchUsers');\n    if (searchUsers) {\n        let timeout;\n        searchUsers.addEventListener('keyup', e => {\n            clearTimeout(timeout);\n            timeout = setTimeout(() => {\n                window.console.log('Buscar', e.target.value);\n                callGetUsers(learningplanid, 1, 5, e.target.value, true);\n            }, 500);\n        });\n    }\n};\n\nconst addUserAction = (learningplanid) => {\n    const userselected = document.querySelector('#listusers');\n    const itemvalue = document.querySelector('#listusers-hidden');\n    const roleselected = document.querySelector('#listroles');\n    userselected.addEventListener('change', () => {\n        const val = userselected.value;\n        const userList = document.querySelector(`#users-list option[value='${val}']`);\n        if (userList) {\n            itemvalue.value = userList.getAttribute('data-id');\n        }\n    });\n\n    const btnadduser = document.querySelector('#adduser');\n    if (btnadduser) {\n        btnadduser.addEventListener('click', e => {\n            e.preventDefault();\n            if (userselected && roleselected) {\n                const userid = itemvalue.value;\n                const roleid = roleselected.value;\n                callAddUser(learningplanid, userid, roleid);\n            }\n        });\n    }\n};\n\nconst createUserTableRow = (userid, firstname, lastname, email, rolename, learningplanid, nameperiod) => {\n    const el_tr = document.createElement('tr');\n    const el_td_userid = document.createElement('td');\n    const el_td_username = document.createElement('td');\n    const el_td_email = document.createElement('td');\n    const el_td_periodname = document.createElement('td');\n    const el_td_rolename = document.createElement('td');\n    const el_td_btn = document.createElement('td');\n    const el_btn = document.createElement('button');\n    const el_i = document.createElement('i');\n\n    el_td_userid.innerHTML = userid;\n    el_td_username.innerHTML = `${firstname} ${lastname}`;\n    el_td_email.innerHTML = email;\n    el_td_rolename.innerHTML = rolename;\n    el_btn.id = 'deleteuser';\n    el_btn.classList.add('btn');\n    el_btn.setAttribute('userid', userid);\n    el_btn.setAttribute('data-toggle', 'tooltip');\n    el_btn.setAttribute('data-placement', 'bottom');\n    el_btn.setAttribute('data-original-title', 'Delete User');\n    el_i.classList.add('lp_icon', 'fa', 'fa-trash', 'fa-fw');\n    el_btn.append(el_i);\n    el_td_btn.append(el_btn);\n    el_btn.addEventListener('click', e => {\n        e.preventDefault();\n        const userid = e.target.parentElement.getAttribute('userid');\n        const titleconfirm = Str.get_string('titleconfirm', 'local_sc_learningplans');\n        const msgconfirm = Str.get_string('msgconfirm_user', 'local_sc_learningplans');\n        const yesconfirm = Str.get_string('yesconfirm', 'local_sc_learningplans');\n        notification.saveCancel(titleconfirm, msgconfirm, yesconfirm, () => {\n            const removeenrol = document.querySelector('#checkRemoveCourses');\n            callDeleteUser(learningplanid, userid, removeenrol ? removeenrol.checked : false);\n        });\n    });\n    el_tr.append(el_td_userid);\n    el_tr.append(el_td_username);\n    el_tr.append(el_td_email);\n    if (nameperiod != undefined) {\n        el_td_periodname.innerHTML = nameperiod;\n        el_tr.append(el_td_periodname);\n    } else {\n        el_td_periodname.remove();\n    }\n    el_tr.append(el_td_rolename);\n    el_tr.append(el_td_btn);\n    return el_tr;\n};\n\nconst callGetUsers = (learningid, page, recordsperpage, search = null, renderpages = false) => {\n    learningid = parseInt(learningid);\n    page = parseInt(page);\n    recordsperpage = parseInt(recordsperpage);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_get_learning_users',\n        args: {\n            learningid,\n            page,\n            recordsperpage,\n            search\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_get_learning_users', response);\n        const usersTable = document.querySelector('#usersTable tbody');\n        usersTable.innerHTML = '';\n        if (usersTable) {\n            for (const element of response.learningusers) {\n                const tr = createUserTableRow(\n                    element.userid,\n                    element.firstname,\n                    element.lastname,\n                    element.email,\n                    element.userrolename,\n                    learningid,\n                    element.nameperiod,\n                );\n                usersTable.append(tr);\n            }\n        }\n        if (renderpages) {\n            const userpaginationsc = document.querySelector('#userpaginationsc');\n            if (userpaginationsc) {\n                userpaginationsc.innerHTML = '';\n                const totalpages = Math.ceil(response.totalusers / recordsperpage);\n                for (let index = 1; index <= totalpages; index++) {\n                    const elpage = document.createElement('a');\n                    elpage.innerHTML = `${index}`;\n                    if (index == 1) {\n                        elpage.classList.add('activelp');\n                    }\n                    elpage.addEventListener('click', el => {\n                        let pageactive = document.querySelector('a.activelp');\n                        if (pageactive) {\n                            pageactive.classList.remove('activelp');\n                        }\n                        el.preventDefault();\n                        el.target.classList.add('activelp');\n                        usersTable.innerHTML = '';\n                        callGetUsers(learningid, index, recordsperpage, search, false);\n                    });\n                    userpaginationsc.append(elpage);\n                }\n            }\n        }\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nconst callDeleteUser = (learningplan, userid, unenrol) => {\n    learningplan = parseInt(learningplan);\n    userid = parseInt(userid);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_delete_learning_user',\n        args: {\n            learningplan,\n            userid,\n            unenrol,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_delete_learning_user', response);\n        window.location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};\n\nconst callAddUser = (learningplan, userid, roleid) => {\n    learningplan = parseInt(learningplan);\n    userid = parseInt(userid);\n    roleid = parseInt(roleid);\n    const promise = Ajax.call([{\n        methodname: 'local_sc_learningplans_add_learning_user',\n        args: {\n            learningplan,\n            userid,\n            roleid,\n        }\n    },]);\n\n    promise[0].done(function (response) {\n        window.console.log('local_sc_learningplans_add_learning_user', response);\n        window.location.reload();\n    }).fail(function (response) {\n        window.console.error(response);\n    });\n};"],"names":["learningplanid","callGetUsers","addUserAction","timeout","searchUsers","document","querySelector","addEventListener","e","clearTimeout","setTimeout","window","console","log","target","value","userselected","itemvalue","roleselected","val","userList","getAttribute","btnadduser","preventDefault","userid","roleid","callAddUser","createUserTableRow","firstname","lastname","email","rolename","nameperiod","el_tr","createElement","el_td_userid","el_td_username","el_td_email","el_td_periodname","el_td_rolename","el_td_btn","el_btn","el_i","innerHTML","id","classList","add","setAttribute","append","parentElement","titleconfirm","Str","get_string","msgconfirm","yesconfirm","notification","saveCancel","removeenrol","callDeleteUser","checked","undefined","remove","learningid","page","recordsperpage","search","renderpages","parseInt","promise","Ajax","call","methodname","args","done","response","usersTable","learningusers","element","tr","userrolename","userpaginationsc","totalpages","Math","ceil","totalusers","index","elpage","el","pageactive","fail","error","learningplan","unenrol","location","reload"],"mappings":"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"}