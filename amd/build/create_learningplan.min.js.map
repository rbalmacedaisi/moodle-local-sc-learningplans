{"version":3,"file":"create_learningplan.min.js","sources":["../src/create_learningplan.js"],"sourcesContent":["/* import * as Ajax from 'core/ajax';*/\nimport * as Str from 'core/str';\n\nexport const init = (str_name_period_config, default_period_months) => {\n    /*const btnadd = document.querySelector('#addplan');\n     if (btnadd) {\n        btnadd.addEventListener('click', e => {\n            e.preventDefault();\n            const plannameelement = document.querySelector('#learningname');\n            if (!plannameelement.validity.valid) {\n                plannameelement.reportValidity();\n                return;\n            }\n            const learningshortid = document.querySelector('#learningshortid');\n            if (!learningshortid.validity.valid) {\n                learningshortid.reportValidity();\n                return;\n            }\n            const learningname = document.querySelector('#learningname');\n            const desc_plan = document.querySelector('#id_desc_plan');\n            const learningimage = document.querySelector('#id_learningplan_image');\n            const btnscourse = document.querySelectorAll('button[courseid]');\n            const btnsusers = document.querySelectorAll('button[userid]');\n            const listperiods = document.querySelectorAll('.period_name');\n            const periods = [];\n            const courses = [];\n            const users = [];\n            const type_enrol_manual = document.getElementById(\"type_manual\");\n            const type_enrol_automatic = document.getElementById(\"type_automatic\");\n            let hasperiod = 0;\n            let type_enrol = 0;\n            if (type_enrol_manual != null) {\n                if (type_enrol_manual.checked) {\n                    type_enrol = 1;\n                }\n            } else {\n                type_enrol = 0;\n            }\n            if (type_enrol_automatic != null) {\n                if (type_enrol_automatic.checked) {\n                    type_enrol = 2;\n                }\n            } else {\n                type_enrol = 0;\n            }\n            if (document.getElementById('addperiod').checked) {\n                hasperiod = 1;\n            }\n            listperiods.forEach(e => {\n                periods.push({\n                    name: e.value,\n                    vigency: 0\n                });\n            });\n            if (btnscourse.length != 0) {\n                btnscourse.forEach(e => {\n                    courses.push({\n                        courseid: parseInt(e.getAttribute('courseid')),\n                        required: parseInt(e.getAttribute('isrequired')),\n                        credits: -1,\n                    });\n                });\n            }\n            if (btnsusers.length != 0) {\n                btnsusers.forEach(e => {\n                    users.push({\n                        userid: parseInt(e.getAttribute('userid')),\n                        roleid: parseInt(e.getAttribute('roleid')),\n                    });\n                });\n            }\n            const promise = Ajax.call([{\n                methodname: 'local_sc_learningplans_save_learning_plan',\n                args: {\n                    learningname: learningname.value,\n                    periods,\n                    courses,\n                    users,\n                    fileimage: learningimage.value,\n                    description: desc_plan.value,\n                    hasperiod: hasperiod,\n                    enroltype: type_enrol,\n                }\n            },]);\n            promise[0].done(function (response) {\n                window.console.log('local_sc_learningplans_save_learning_plan', response);\n                location.href = '/local/sc_learningplans/index.php';\n            }).fail(function (response) {\n                window.console.error(response);\n            });\n        });\n    }\n\n    const selectedcourse = document.querySelector('#selectAddCourseToLearningPlan');\n    const addrequired = document.querySelector('#addrequired');\n    const requiredlist = document.querySelector('#formCurrentCourseToLearningPlan');\n    if (addrequired && requiredlist) {\n        addrequired.addEventListener('click', async e => {\n            e.preventDefault();\n            if (!selectedcourse.value) {\n                return;\n            }\n            const selectedoption = selectedcourse.querySelector(`option[value=\"${selectedcourse.value}\"]`);\n            window.console.log(selectedoption, `option[value=\"${selectedcourse.value}\"]`);\n            if (selectedoption) {\n                selectedoption.disabled = true;\n                const coursename = selectedoption.innerHTML;\n                const courseid = selectedcourse.value;\n\n                const divcontainer = document.createElement('div');\n                const div = document.createElement('div');\n                div.id = `optionalcourse-${courseid}`;\n                div.classList.add('lp_course_list', 'p-1', 'alert-primary');\n                div.innerHTML = coursename;\n                const deletebtn = document.createElement('button');\n                const strdelete = await Str.get_string('delete_current_course', 'local_sc_learningplans');\n                window.console.log(strdelete);\n                deletebtn.setAttribute('isrequired', 1);\n                deletebtn.setAttribute('courseid', courseid);\n                deletebtn.setAttribute('aria-label', 'Close');\n                deletebtn.setAttribute('type', 'button');\n                deletebtn.classList.add('close');\n                deletebtn.onclick = e => {\n                    e.preventDefault();\n                    window.console.log(e.target, e.target.getAttribute('courseid'));\n                    selectedoption.disabled = false;\n                    divcontainer.remove();\n                };\n                const deleteicon = document.createElement('i');\n                deleteicon.classList.add('fa', 'fa-close');\n                divcontainer.append(div);\n                div.append(deletebtn);\n                requiredlist.append(divcontainer);\n                deletebtn.append(deleteicon);\n                selectedcourse.value = '';\n            }\n        });\n    }\n\n    const addoptional = document.querySelector('#addooptional');\n    const optionallist = document.querySelector('#formOptionalCourseToLearningPlan');\n    if (addoptional && optionallist) {\n        addoptional.addEventListener('click', async e => {\n            e.preventDefault();\n            if (!selectedcourse.value) {\n                return;\n            }\n            const selectedoption = selectedcourse.querySelector(`option[value=\"${selectedcourse.value}\"]`);\n            window.console.log(selectedoption, `option[value=\"${selectedcourse.value}\"]`);\n            if (selectedoption) {\n                selectedoption.disabled = true;\n                const coursename = selectedoption.innerHTML;\n                const courseid = selectedcourse.value;\n\n                const divcontainer = document.createElement('div');\n                const div = document.createElement('div');\n                div.id = `requiredcourse-${courseid}`;\n                div.classList.add('lp_course_list', 'p-1', 'alert-info');\n                div.innerHTML = coursename;\n                const deletebtn = document.createElement('button');\n                deletebtn.setAttribute('isrequired', 0);\n                deletebtn.setAttribute('courseid', courseid);\n                deletebtn.setAttribute('aria-label', 'Close');\n                deletebtn.setAttribute('type', 'button');\n                deletebtn.classList.add('close');\n                deletebtn.onclick = e => {\n                    e.preventDefault();\n                    window.console.log(e.target, e.target.getAttribute('courseid'));\n                    selectedoption.disabled = false;\n                    divcontainer.remove();\n                };\n                const deleteicon = document.createElement('i');\n                deleteicon.classList.add('fa', 'fa-close');\n                divcontainer.append(div);\n                div.append(deletebtn);\n                optionallist.append(divcontainer);\n                deletebtn.append(deleteicon);\n                selectedcourse.value = '';\n            }\n        });\n    }\n\n    const adduser = document.querySelector('#adduser');\n    const listusers = document.querySelector('#listusers');\n    const listroles = document.querySelector('#listroles');\n    const listlearningusers = document.querySelector('.listlearningusers');\n    if (adduser && listusers && listroles) {\n        adduser.addEventListener('click', async e => {\n            e.preventDefault();\n            if (!listusers.validity.valid) {\n                listusers.reportValidity();\n                return;\n            }\n            if (!listroles.validity.valid) {\n                listroles.reportValidity();\n                return;\n            }\n            const selectedoption = listusers.querySelector(`option[value=\"${listusers.value}\"]`);\n            if (selectedoption) {\n                const userid = listusers.value;\n                const roleid = listroles.value;\n                const username = selectedoption.innerHTML;\n                selectedoption.disabled = true;\n                const divcontainer = document.createElement('div');\n                const div = document.createElement('div');\n                div.classList.add('lp_user_list', 'p-1', 'alert-primary');\n                div.innerHTML = username;\n                const deletebtn = document.createElement('button');\n                deletebtn.setAttribute('roleid', roleid);\n                deletebtn.setAttribute('userid', userid);\n                deletebtn.setAttribute('aria-label', 'Close');\n                deletebtn.setAttribute('type', 'button');\n                deletebtn.classList.add('close');\n                deletebtn.onclick = e => {\n                    e.preventDefault();\n                    selectedoption.disabled = false;\n                    divcontainer.remove();\n                };\n                const deleteicon = document.createElement('i');\n                deleteicon.classList.add('fa', 'fa-close');\n                divcontainer.append(div);\n                div.append(deletebtn);\n                listlearningusers.append(divcontainer);\n                deletebtn.append(deleteicon);\n                listusers.value = '';\n                listroles.value = '';\n            }\n        });\n    } */\n    addPeriodsOrNot(str_name_period_config, default_period_months);\n};\n\nlet addPeriodsOrNot = async (str_name_period_config, default_period_months) => {\n    const addperiod = document.querySelector('#addperiod');\n    if (addperiod) {\n        const periodname = await Str.get_string('periodname', 'local_sc_learningplans');\n        //const period = await Str.get_string('period', 'local_sc_learningplans');\n        const typeperiod = await Str.get_string('typeperiod', 'local_sc_learningplans');\n        const manual = await Str.get_string('manual', 'local_sc_learningplans');\n        const auto = await Str.get_string('auto', 'local_sc_learningplans');\n        const periodmonths = await Str.get_string('periodmonths', 'local_sc_learningplans');\n\n        const divInput = document.createElement('div');\n        const label = document.createElement('label');\n        const input = document.createElement('input');\n        input.classList.add('period_name');\n\n        addperiod.addEventListener('click', () => {\n            let addingperiods = document.getElementById('addingperiods');\n            addingperiods.disabled = false;\n            let optperiod = document.getElementById('periodslist');\n            optperiod.disabled = false;\n            let parent = document.getElementById('listperiods');\n            let parent_enrol = document.getElementById('type_enrol');\n            if (addingperiods) {\n                addingperiods.addEventListener('click', () => {\n                    parent.innerHTML = '';\n                    let value = optperiod.options[optperiod.selectedIndex].value;\n                    for (let i = 1; i <= value; i++) {\n                        const labelForName = label.cloneNode();\n                        labelForName.setAttribute('for', `period_${i}`);\n                        labelForName.innerHTML = `${periodname} ${i}:&nbsp;`;\n\n                        const inputForName = input.cloneNode();\n                        inputForName.setAttribute('value', `${str_name_period_config} ${i}`);\n                        inputForName.placeholder = `${str_name_period_config} ${i}`;\n                        inputForName.id = `inputPeriodName${i}`;\n\n                        const labelForMonths = label.cloneNode();\n                        labelForMonths.setAttribute('for', `period_months_${i}`);\n                        labelForMonths.innerHTML = `&nbsp;&nbsp;${periodmonths}:&nbsp;`;\n\n                        const inputForMonths = input.cloneNode();\n                        inputForMonths.setAttribute('value', default_period_months);\n                        inputForMonths.placeholder = default_period_months;\n                        inputForMonths.id = `inputPeriodMonth${i}`;\n\n                        const divToPut = divInput.cloneNode();\n                        divToPut.append(labelForName);\n                        divToPut.append(inputForName);\n                        divToPut.append(labelForMonths);\n                        divToPut.append(inputForMonths);\n                        parent.append(divToPut);\n                    }\n                    parent_enrol.innerHTML = `<div><label class=\"w-100\">${typeperiod}</label>\n                                              <input type=\"radio\" id=\"type_manual\" name=\"enrol_period\" value=\"1\">\n                                              <label for=\"type_manual\">${manual}</label>\n                                              <input type=\"radio\" id=\"type_automatic\" name=\"enrol_period\" value=\"2\">\n                                              <label for=\"css\">${auto}</label></div>`;\n\n                });\n                document.getElementById('addcourses').classList.remove(\"d-block\");\n                document.getElementById('listcoursesplan').classList.remove(\"d-block\");\n                document.getElementById('listusersplan').classList.remove(\"d-block\");\n                document.getElementById('addcourses').classList.add(\"d-none\");\n                document.getElementById('listcoursesplan').classList.add(\"d-none\");\n                document.getElementById('listusersplan').classList.add(\"d-none\");\n            }\n        });\n    }\n    const notperiod = document.querySelector('#notperiod');\n    if (notperiod) {\n        notperiod.addEventListener('click', () => {\n            document.getElementById('listperiods').innerHTML = '';\n            document.getElementById('type_enrol').innerHTML = '';\n            let addingperiods = document.getElementById('addingperiods');\n            addingperiods.disabled = true;\n            document.getElementById('addcourses').classList.remove(\"d-none\");\n            document.getElementById('listcoursesplan').classList.remove(\"d-none\");\n            document.getElementById('listusersplan').classList.remove(\"d-none\");\n            document.getElementById('addcourses').classList.add(\"d-block\");\n            document.getElementById('listcoursesplan').classList.add(\"d-block\");\n            document.getElementById('listusersplan').classList.add(\"d-block\");\n        });\n    }\n};"],"names":["str_name_period_config","default_period_months","addPeriodsOrNot","addperiod","document","querySelector","Str","get_string","periodname","typeperiod","manual","auto","periodmonths","divInput","createElement","label","input","classList","add","addEventListener","addingperiods","getElementById","disabled","optperiod","parent","parent_enrol","innerHTML","value","options","selectedIndex","i","labelForName","cloneNode","setAttribute","inputForName","placeholder","id","labelForMonths","inputForMonths","divToPut","append","remove","notperiod"],"mappings":"+kDAGoB,SAACA,uBAAwBC,uBAkOzCC,gBAAgBF,uBAAwBC,oCAGxCC,6CAAkB,iBAAOF,uBAAwBC,6NAC3CE,UAAYC,SAASC,cAAc,8DAEZC,IAAIC,WAAW,aAAc,wCAAhDC,yCAEmBF,IAAIC,WAAW,aAAc,wCAAhDE,0CACeH,IAAIC,WAAW,SAAU,yCAAxCG,sCACaJ,IAAIC,WAAW,OAAQ,yCAApCI,oCACqBL,IAAIC,WAAW,eAAgB,kCAApDK,2BAEAC,SAAWT,SAASU,cAAc,OAClCC,MAAQX,SAASU,cAAc,UAC/BE,MAAQZ,SAASU,cAAc,UAC/BG,UAAUC,IAAI,eAEpBf,UAAUgB,iBAAiB,SAAS,eAC5BC,cAAgBhB,SAASiB,eAAe,iBAC5CD,cAAcE,UAAW,MACrBC,UAAYnB,SAASiB,eAAe,eACxCE,UAAUD,UAAW,MACjBE,OAASpB,SAASiB,eAAe,eACjCI,aAAerB,SAASiB,eAAe,cACvCD,gBACAA,cAAcD,iBAAiB,SAAS,WACpCK,OAAOE,UAAY,WACfC,MAAQJ,UAAUK,QAAQL,UAAUM,eAAeF,MAC9CG,EAAI,EAAGA,GAAKH,MAAOG,IAAK,KACvBC,aAAehB,MAAMiB,YAC3BD,aAAaE,aAAa,uBAAiBH,IAC3CC,aAAaL,oBAAelB,uBAAcsB,iBAEpCI,aAAelB,MAAMgB,YAC3BE,aAAaD,aAAa,kBAAYjC,mCAA0B8B,IAChEI,aAAaC,sBAAiBnC,mCAA0B8B,GACxDI,aAAaE,4BAAuBN,OAE9BO,eAAiBtB,MAAMiB,YAC7BK,eAAeJ,aAAa,8BAAwBH,IACpDO,eAAeX,gCAA2Bd,4BAEpC0B,eAAiBtB,MAAMgB,YAC7BM,eAAeL,aAAa,QAAShC,uBACrCqC,eAAeH,YAAclC,sBAC7BqC,eAAeF,6BAAwBN,OAEjCS,SAAW1B,SAASmB,YAC1BO,SAASC,OAAOT,cAChBQ,SAASC,OAAON,cAChBK,SAASC,OAAOH,gBAChBE,SAASC,OAAOF,gBAChBd,OAAOgB,OAAOD,UAElBd,aAAaC,8CAAyCjB,0NAEDC,iNAERC,0BAGjDP,SAASiB,eAAe,cAAcJ,UAAUwB,OAAO,WACvDrC,SAASiB,eAAe,mBAAmBJ,UAAUwB,OAAO,WAC5DrC,SAASiB,eAAe,iBAAiBJ,UAAUwB,OAAO,WAC1DrC,SAASiB,eAAe,cAAcJ,UAAUC,IAAI,UACpDd,SAASiB,eAAe,mBAAmBJ,UAAUC,IAAI,UACzDd,SAASiB,eAAe,iBAAiBJ,UAAUC,IAAI,uBAI7DwB,UAAYtC,SAASC,cAAc,gBAErCqC,UAAUvB,iBAAiB,SAAS,WAChCf,SAASiB,eAAe,eAAeK,UAAY,GACnDtB,SAASiB,eAAe,cAAcK,UAAY,GAC9BtB,SAASiB,eAAe,iBAC9BC,UAAW,EACzBlB,SAASiB,eAAe,cAAcJ,UAAUwB,OAAO,UACvDrC,SAASiB,eAAe,mBAAmBJ,UAAUwB,OAAO,UAC5DrC,SAASiB,eAAe,iBAAiBJ,UAAUwB,OAAO,UAC1DrC,SAASiB,eAAe,cAAcJ,UAAUC,IAAI,WACpDd,SAASiB,eAAe,mBAAmBJ,UAAUC,IAAI,WACzDd,SAASiB,eAAe,iBAAiBJ,UAAUC,IAAI"}