define("local_sc_learningplans/create_learningplan",["exports","core/ajax","core/str"],(function(_exports,Ajax,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=_interopRequireWildcard(Ajax),Str=_interopRequireWildcard(Str);const learningshortid=document.getElementById("learningshortid"),plannameelement=document.getElementById("learningname"),btnadd=document.getElementById("addplan"),addperiod=document.getElementById("addperiod"),notperiod=document.getElementById("notperiod"),optperiod=document.getElementById("periodslist"),addingperiods=document.getElementById("addingperiods"),parent=document.getElementById("listperiods"),parent_enrol=document.getElementById("type_enrol"),addcourses=document.getElementById("addcourses"),listcoursesplan=document.getElementById("listcoursesplan"),addrequired=document.getElementById("addrequired"),addoptional=document.getElementById("addooptional"),requiredlist=document.getElementById("formCurrentCourseToLearningPlan"),optionallist=document.getElementById("formOptionalCourseToLearningPlan"),selectedcourse=document.getElementById("selectAddCourseToLearningPlan"),listusersplan=document.getElementById("listusersplan"),adduser=document.getElementById("adduser"),listusers=document.getElementById("listusers"),listroles=document.getElementById("listroles"),listgroups=document.getElementById("listgroups"),learningimage=document.getElementById("id_learningplan_image"),careercost=document.getElementById("careercost"),careerduration=document.getElementById("careerduration"),careername=document.getElementById("careername");_exports.init=(str_name_period_config,default_period_months)=>{addLearningPlan(),addUsers(),addCourses(),addPeriodsOrNot(str_name_period_config,default_period_months)};let addLearningPlan=()=>{btnadd&&btnadd.addEventListener("click",(e=>{e.preventDefault();let desc_plan=document.getElementById("id_desc_planeditable");if(!learningshortid.validity.valid)return void learningshortid.reportValidity();if(!plannameelement.validity.valid)return void plannameelement.reportValidity();if(!careercost.validity.valid)return void careercost.reportValidity();if(!careerduration.validity.valid)return void careerduration.reportValidity();if(!careername.validity.valid)return void careername.reportValidity();const btnscourse=document.querySelectorAll("button[courseid]"),btnsusers=document.querySelectorAll("button[userid]"),listperiods=document.querySelectorAll(".period_name"),type_enrol_manual=document.getElementById("type_manual"),type_enrol_automatic=document.getElementById("type_automatic"),hasperiod=addperiod.checked?1:0,type_enrol=setTypeEnrol(type_enrol_manual,type_enrol_automatic),periods=[],courses=[],users=[];listperiods.forEach((e=>{const index=e.getAttribute("index"),name=""==e.value?index:e.value,monthsElement=document.querySelector("#inputPeriodMonth".concat(index));let months=0;monthsElement&&(months=""==monthsElement.value?0:monthsElement.value),periods.push({name:name,months:months})})),0!=btnscourse.length&&0==hasperiod&&btnscourse.forEach((e=>{courses.push({courseid:parseInt(e.getAttribute("courseid")),required:parseInt(e.getAttribute("isrequired")),credits:-1})})),0!=btnsusers.length&&0==hasperiod&&btnsusers.forEach((e=>{users.push({userid:parseInt(e.getAttribute("userid")),roleid:parseInt(e.getAttribute("roleid")),group:e.getAttribute("group")})})),window.NodeList&&!window.NodeList.prototype.map&&(window.NodeList.prototype.map=Array.prototype.map);const requirements=document.querySelectorAll("input[name=learningrequirements]:checked").map((el=>el.value)).join(),customfields=[];document.getElementsByClassName("customfield").forEach((_ref=>{let{id:id,value:value}=_ref;value&&customfields.push({id:id,value:value})}));const args={learningshortid:learningshortid.value,learningname:plannameelement.value,periods:periods,courses:courses,users:users,fileimage:learningimage.value,description:desc_plan.innerHTML,hasperiod:hasperiod,enroltype:type_enrol,requirements:requirements,customfields:customfields};Ajax.call([{methodname:"local_sc_learningplans_save_learning_plan",args:args}])[0].done((function(response){window.console.log("local_sc_learningplans_save_learning_plan",response),window.location.href="/local/sc_learningplans/index.php"})).fail((function(response){window.console.error(response)}))}))},addUsers=()=>{const listlearningusers=document.querySelector(".listlearningusers");adduser&&listusers&&listroles&&adduser.addEventListener("click",(async e=>{if(e.preventDefault(),!listusers.validity.valid)return void listusers.reportValidity();if(!listroles.validity.valid)return void listroles.reportValidity();const selectedoption=listusers.querySelector('option[value="'.concat(listusers.value,'"]'));if(selectedoption){const userid=listusers.value,roleid=listroles.value,group=listgroups.value,username=selectedoption.innerHTML;selectedoption.disabled=!0;const divcontainer=document.createElement("div"),div=document.createElement("div");div.classList.add("lp_user_list","p-2","alert-primary","rounded-sm","mb-1"),div.innerHTML=username;const deletebtn=document.createElement("button");deletebtn.setAttribute("roleid",roleid),deletebtn.setAttribute("userid",userid),deletebtn.setAttribute("group",group),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=e=>{e.preventDefault(),selectedoption.disabled=!1,divcontainer.remove()};const deleteicon=document.createElement("i");deleteicon.classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),listlearningusers.append(divcontainer),deletebtn.append(deleteicon),listusers.value="",listroles.value=""}}))},addCourses=async()=>{addrequired&&requiredlist&&addrequired.addEventListener("click",(async e=>{if(e.preventDefault(),!selectedcourse.value)return;const selectedoption=selectedcourse.querySelector('option[value="'.concat(selectedcourse.value,'"]'));if(window.console.log(selectedoption,'option[value="'.concat(selectedcourse.value,'"]')),selectedoption){selectedoption.disabled=!0;const coursename=selectedoption.innerHTML,courseid=selectedcourse.value,divcontainer=document.createElement("div"),div=document.createElement("div");div.id="optionalcourse-".concat(courseid),div.classList.add("lp_course_list","p-2","alert-primary","rounded-sm","mb-1"),div.innerHTML=coursename;const deletebtn=document.createElement("button");deletebtn.setAttribute("isrequired",1),deletebtn.setAttribute("courseid",courseid),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=e=>{e.preventDefault(),window.console.log(e.target,e.target.getAttribute("courseid")),selectedoption.disabled=!1,divcontainer.remove()};const deleteicon=document.createElement("i");deleteicon.classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),requiredlist.append(divcontainer),deletebtn.append(deleteicon),selectedcourse.value=""}})),addoptional&&optionallist&&addoptional.addEventListener("click",(async e=>{if(e.preventDefault(),!selectedcourse.value)return;const selectedoption=selectedcourse.querySelector('option[value="'.concat(selectedcourse.value,'"]'));if(window.console.log(selectedoption,'option[value="'.concat(selectedcourse.value,'"]')),selectedoption){selectedoption.disabled=!0;const coursename=selectedoption.innerHTML,courseid=selectedcourse.value,divcontainer=document.createElement("div"),div=document.createElement("div");div.id="requiredcourse-".concat(courseid),div.classList.add("lp_course_list","p-2","alert-info","rounded-sm","mb-1"),div.innerHTML=coursename;const deletebtn=document.createElement("button");deletebtn.setAttribute("isrequired",0),deletebtn.setAttribute("courseid",courseid),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=e=>{e.preventDefault(),window.console.log(e.target,e.target.getAttribute("courseid")),selectedoption.disabled=!1,divcontainer.remove()};const deleteicon=document.createElement("i");deleteicon.classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),optionallist.append(divcontainer),deletebtn.append(deleteicon),selectedcourse.value=""}}))},addPeriodsOrNot=async(str_name_period_config,default_period_months)=>{if(addperiod){const periodname=await Str.get_string("periodname","local_sc_learningplans"),typeperiod=await Str.get_string("typeperiod","local_sc_learningplans"),manual=await Str.get_string("manual","local_sc_learningplans"),auto=await Str.get_string("auto","local_sc_learningplans"),periodmonths=await Str.get_string("periodmonths","local_sc_learningplans"),divInput=document.createElement("div"),divCol=document.createElement("div"),label=document.createElement("label"),input=document.createElement("input");addperiod.addEventListener("click",(()=>{addingperiods.disabled=!1,optperiod.disabled=!1,addingperiods&&(addingperiods.addEventListener("click",(()=>{parent.innerHTML="",careerduration.value=null,careerduration.disabled=!0;let value=optperiod.value;for(let i=1;i<=value;i++){const labelForName=label.cloneNode();labelForName.setAttribute("for","period_".concat(i)),labelForName.innerHTML="".concat(periodname," ").concat(i,":&nbsp;");const inputForName=input.cloneNode();inputForName.classList.add("period_name"),inputForName.classList.add("form-control"),inputForName.setAttribute("value","".concat(str_name_period_config," ").concat(i)),inputForName.setAttribute("index",i),inputForName.placeholder="".concat(str_name_period_config," ").concat(i),inputForName.id="inputPeriodName".concat(i);const labelForMonths=label.cloneNode();labelForMonths.setAttribute("for","period_months_".concat(i)),labelForMonths.innerHTML="&nbsp;&nbsp;".concat(periodmonths,":&nbsp;");const inputForMonths=input.cloneNode();inputForMonths.classList.add("form-control"),inputForMonths.setAttribute("value",default_period_months),inputForMonths.placeholder=default_period_months,inputForMonths.setAttribute("index",i),inputForMonths.id="inputPeriodMonth".concat(i);const div_col=divCol.cloneNode();div_col.classList.add("col-sm-6"),div_col.append(labelForName),div_col.append(inputForName);const div_col_months=divCol.cloneNode();div_col_months.classList.add("col-sm-6"),div_col_months.append(labelForMonths),div_col_months.append(inputForMonths);const divToPut=divInput.cloneNode();divToPut.classList.add("row"),divToPut.append(div_col),divToPut.append(div_col_months),parent.append(divToPut)}parent_enrol.innerHTML='<div><label class="w-100">'.concat(typeperiod,'</label>\n                                              <input type="radio" id="type_manual" name="enrol_period" value="1">\n                                              <label for="type_manual">').concat(manual,'</label>\n                                              <input type="radio" id="type_automatic" name="enrol_period" value="2">\n                                              <label for="css">').concat(auto,"</label></div>");const listperiods=document.querySelectorAll(".period_name");let months=0;listperiods.forEach((e=>{const index=e.getAttribute("index"),monthsElement=document.querySelector("#inputPeriodMonth".concat(index));let monthsvalue=monthsElement&&""==monthsElement.value?0:parseInt(monthsElement.value);months+=monthsvalue}))})),addcourses.classList.remove("d-block"),addcourses.classList.add("d-none"),listcoursesplan.classList.remove("d-block"),listcoursesplan.classList.add("d-none"),listusersplan.classList.remove("d-block"),listusersplan.classList.add("d-none"))}))}notperiod&&notperiod.addEventListener("click",(()=>{careerduration.disabled=!1,parent.innerHTML="",parent_enrol.innerHTML="",addingperiods.disabled=!0,addcourses.classList.remove("d-none"),addcourses.classList.add("d-block"),listcoursesplan.classList.remove("d-none"),listcoursesplan.classList.add("d-block"),listusersplan.classList.remove("d-none"),listusersplan.classList.add("d-block")}))};const setTypeEnrol=(type_enrol_manual,type_enrol_automatic)=>type_enrol_manual&&type_enrol_manual.checked?1:type_enrol_automatic&&type_enrol_automatic.checked?2:0}));

//# sourceMappingURL=create_learningplan.min.js.map