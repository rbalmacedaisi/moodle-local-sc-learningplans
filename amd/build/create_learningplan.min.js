function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("local_sc_learningplans/create_learningplan",["exports","core/ajax","core/str"],(function(_exports,Ajax,Str){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!==_typeof(obj)&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}return newObj.default=obj,cache&&cache.set(obj,newObj),newObj}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,Ajax=_interopRequireWildcard(Ajax),Str=_interopRequireWildcard(Str);var learningshortid=document.getElementById("learningshortid"),plannameelement=document.getElementById("learningname"),btnadd=document.getElementById("addplan"),addperiod=document.getElementById("addperiod"),notperiod=document.getElementById("notperiod"),optperiod=document.getElementById("periodslist"),addingperiods=document.getElementById("addingperiods"),parent=document.getElementById("listperiods"),parent_enrol=document.getElementById("type_enrol"),addcourses=document.getElementById("addcourses"),listcoursesplan=document.getElementById("listcoursesplan"),addrequired=document.getElementById("addrequired"),addoptional=document.getElementById("addooptional"),requiredlist=document.getElementById("formCurrentCourseToLearningPlan"),optionallist=document.getElementById("formOptionalCourseToLearningPlan"),selectedcourse=document.getElementById("selectAddCourseToLearningPlan"),listusersplan=document.getElementById("listusersplan"),adduser=document.getElementById("adduser"),listusers=document.getElementById("listusers"),listroles=document.getElementById("listroles"),listgroups=document.getElementById("listgroups"),learningimage=document.getElementById("id_learningplan_image"),careercost=document.getElementById("careercost"),careerduration=document.getElementById("careerduration"),careername=document.getElementById("careername");_exports.init=function(str_name_period_config,default_period_months){addLearningPlan(),addUsers(),addCourses(),addPeriodsOrNot(str_name_period_config,default_period_months)};var _ref3,_ref6,addLearningPlan=function(){btnadd&&btnadd.addEventListener("click",(function(e){e.preventDefault();var desc_plan=document.getElementById("id_desc_planeditable");if(learningshortid.validity.valid)if(plannameelement.validity.valid)if(careercost.validity.valid)if(careerduration.validity.valid)if(careername.validity.valid){var btnscourse=document.querySelectorAll("button[courseid]"),btnsusers=document.querySelectorAll("button[userid]"),listperiods=document.querySelectorAll(".period_name"),type_enrol_manual=document.getElementById("type_manual"),type_enrol_automatic=document.getElementById("type_automatic"),hasperiod=addperiod.checked?1:0,type_enrol=setTypeEnrol(type_enrol_manual,type_enrol_automatic),periods=[],courses=[],users=[];listperiods.forEach((function(e){var index=e.getAttribute("index"),name=""==e.value?index:e.value,monthsElement=document.querySelector("#inputPeriodMonth".concat(index)),months=0;monthsElement&&(months=""==monthsElement.value?0:monthsElement.value),periods.push({name:name,months:months})})),0!=btnscourse.length&&0==hasperiod&&btnscourse.forEach((function(e){courses.push({courseid:parseInt(e.getAttribute("courseid")),required:parseInt(e.getAttribute("isrequired")),credits:-1})})),0!=btnsusers.length&&0==hasperiod&&btnsusers.forEach((function(e){users.push({userid:parseInt(e.getAttribute("userid")),roleid:parseInt(e.getAttribute("roleid")),group:e.getAttribute("group")})})),window.NodeList&&!window.NodeList.prototype.map&&(window.NodeList.prototype.map=Array.prototype.map);var requirements=document.querySelectorAll("input[name=learningrequirements]:checked").map((function(el){return el.value})).join(),customfields=[];document.getElementsByClassName("customfield").forEach((function(_ref){var id=_ref.id,value=_ref.value;value&&customfields.push({id:id,value:value})}));var args={learningshortid:learningshortid.value,learningname:plannameelement.value,periods:periods,courses:courses,users:users,fileimage:learningimage.value,description:desc_plan.innerHTML,hasperiod:hasperiod,enroltype:type_enrol,requirements:requirements,customfields:customfields};Ajax.call([{methodname:"local_sc_learningplans_save_learning_plan",args:args}])[0].done((function(response){window.console.log("local_sc_learningplans_save_learning_plan",response),window.location.href="/local/sc_learningplans/index.php"})).fail((function(response){window.console.error(response)}))}else careername.reportValidity();else careerduration.reportValidity();else careercost.reportValidity();else plannameelement.reportValidity();else learningshortid.reportValidity()}))},addUsers=function(){var _ref2,listlearningusers=document.querySelector(".listlearningusers");adduser&&listusers&&listroles&&adduser.addEventListener("click",(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(e){var selectedoption,userid,roleid,group,username,divcontainer,div,deletebtn,deleteicon;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(e.preventDefault(),listusers.validity.valid){_context.next=4;break}return listusers.reportValidity(),_context.abrupt("return");case 4:if(listroles.validity.valid){_context.next=7;break}return listroles.reportValidity(),_context.abrupt("return");case 7:(selectedoption=listusers.querySelector('option[value="'.concat(listusers.value,'"]')))&&(userid=listusers.value,roleid=listroles.value,group=listgroups.value,username=selectedoption.innerHTML,selectedoption.disabled=!0,divcontainer=document.createElement("div"),(div=document.createElement("div")).classList.add("lp_user_list","p-2","alert-primary","rounded-sm","mb-1"),div.innerHTML=username,(deletebtn=document.createElement("button")).setAttribute("roleid",roleid),deletebtn.setAttribute("userid",userid),deletebtn.setAttribute("group",group),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=function(e){e.preventDefault(),selectedoption.disabled=!1,divcontainer.remove()},(deleteicon=document.createElement("i")).classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),listlearningusers.append(divcontainer),deletebtn.append(deleteicon),listusers.value="",listroles.value="");case 9:case"end":return _context.stop()}}),_callee)}))),function(_x){return _ref2.apply(this,arguments)}))},addCourses=(_ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee4(){return regeneratorRuntime.wrap((function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:addrequired&&requiredlist&&addrequired.addEventListener("click",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(e){var selectedoption,coursename,courseid,divcontainer,div,deletebtn,deleteicon;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(e.preventDefault(),selectedcourse.value){_context2.next=3;break}return _context2.abrupt("return");case 3:selectedoption=selectedcourse.querySelector('option[value="'.concat(selectedcourse.value,'"]')),window.console.log(selectedoption,'option[value="'.concat(selectedcourse.value,'"]')),selectedoption&&(selectedoption.disabled=!0,coursename=selectedoption.innerHTML,courseid=selectedcourse.value,divcontainer=document.createElement("div"),(div=document.createElement("div")).id="optionalcourse-".concat(courseid),div.classList.add("lp_course_list","p-2","alert-primary","rounded-sm","mb-1"),div.innerHTML=coursename,(deletebtn=document.createElement("button")).setAttribute("isrequired",1),deletebtn.setAttribute("courseid",courseid),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=function(e){e.preventDefault(),window.console.log(e.target,e.target.getAttribute("courseid")),selectedoption.disabled=!1,divcontainer.remove()},(deleteicon=document.createElement("i")).classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),requiredlist.append(divcontainer),deletebtn.append(deleteicon),selectedcourse.value="");case 6:case"end":return _context2.stop()}}),_callee2)})));return function(_x2){return _ref4.apply(this,arguments)}}()),addoptional&&optionallist&&addoptional.addEventListener("click",function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(e){var selectedoption,coursename,courseid,divcontainer,div,deletebtn,deleteicon;return regeneratorRuntime.wrap((function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(e.preventDefault(),selectedcourse.value){_context3.next=3;break}return _context3.abrupt("return");case 3:selectedoption=selectedcourse.querySelector('option[value="'.concat(selectedcourse.value,'"]')),window.console.log(selectedoption,'option[value="'.concat(selectedcourse.value,'"]')),selectedoption&&(selectedoption.disabled=!0,coursename=selectedoption.innerHTML,courseid=selectedcourse.value,divcontainer=document.createElement("div"),(div=document.createElement("div")).id="requiredcourse-".concat(courseid),div.classList.add("lp_course_list","p-2","alert-info","rounded-sm","mb-1"),div.innerHTML=coursename,(deletebtn=document.createElement("button")).setAttribute("isrequired",0),deletebtn.setAttribute("courseid",courseid),deletebtn.setAttribute("aria-label","Close"),deletebtn.setAttribute("type","button"),deletebtn.classList.add("close"),deletebtn.onclick=function(e){e.preventDefault(),window.console.log(e.target,e.target.getAttribute("courseid")),selectedoption.disabled=!1,divcontainer.remove()},(deleteicon=document.createElement("i")).classList.add("fa","fa-close"),divcontainer.append(div),div.append(deletebtn),optionallist.append(divcontainer),deletebtn.append(deleteicon),selectedcourse.value="");case 6:case"end":return _context3.stop()}}),_callee3)})));return function(_x3){return _ref5.apply(this,arguments)}}());case 2:case"end":return _context4.stop()}}),_callee4)}))),function(){return _ref3.apply(this,arguments)}),addPeriodsOrNot=(_ref6=_asyncToGenerator(regeneratorRuntime.mark((function _callee5(str_name_period_config,default_period_months){var periodname,typeperiod,manual,auto,periodmonths,divInput,divCol,label,input;return regeneratorRuntime.wrap((function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(!addperiod){_context5.next=21;break}return _context5.next=3,Str.get_string("periodname","local_sc_learningplans");case 3:return periodname=_context5.sent,_context5.next=6,Str.get_string("typeperiod","local_sc_learningplans");case 6:return typeperiod=_context5.sent,_context5.next=9,Str.get_string("manual","local_sc_learningplans");case 9:return manual=_context5.sent,_context5.next=12,Str.get_string("auto","local_sc_learningplans");case 12:return auto=_context5.sent,_context5.next=15,Str.get_string("periodmonths","local_sc_learningplans");case 15:periodmonths=_context5.sent,divInput=document.createElement("div"),divCol=document.createElement("div"),label=document.createElement("label"),input=document.createElement("input"),addperiod.addEventListener("click",(function(){addingperiods.disabled=!1,optperiod.disabled=!1,addingperiods&&(addingperiods.addEventListener("click",(function(){parent.innerHTML="",careerduration.value=null,careerduration.disabled=!0;for(var value=optperiod.value,i=1;i<=value;i++){var labelForName=label.cloneNode();labelForName.setAttribute("for","period_".concat(i)),labelForName.innerHTML="".concat(periodname," ").concat(i,":&nbsp;");var inputForName=input.cloneNode();inputForName.classList.add("period_name"),inputForName.classList.add("form-control"),inputForName.setAttribute("value","".concat(str_name_period_config," ").concat(i)),inputForName.setAttribute("index",i),inputForName.placeholder="".concat(str_name_period_config," ").concat(i),inputForName.id="inputPeriodName".concat(i);var labelForMonths=label.cloneNode();labelForMonths.setAttribute("for","period_months_".concat(i)),labelForMonths.innerHTML="&nbsp;&nbsp;".concat(periodmonths,":&nbsp;");var inputForMonths=input.cloneNode();inputForMonths.classList.add("form-control"),inputForMonths.setAttribute("value",default_period_months),inputForMonths.placeholder=default_period_months,inputForMonths.setAttribute("index",i),inputForMonths.id="inputPeriodMonth".concat(i);var div_col=divCol.cloneNode();div_col.classList.add("col-sm-6"),div_col.append(labelForName),div_col.append(inputForName);var div_col_months=divCol.cloneNode();div_col_months.classList.add("col-sm-6"),div_col_months.append(labelForMonths),div_col_months.append(inputForMonths);var divToPut=divInput.cloneNode();divToPut.classList.add("row"),divToPut.append(div_col),divToPut.append(div_col_months),parent.append(divToPut)}parent_enrol.innerHTML='<div><label class="w-100">'.concat(typeperiod,'</label>\n                                              <input type="radio" id="type_manual" name="enrol_period" value="1">\n                                              <label for="type_manual">').concat(manual,'</label>\n                                              <input type="radio" id="type_automatic" name="enrol_period" value="2">\n                                              <label for="css">').concat(auto,"</label></div>");var listperiods=document.querySelectorAll(".period_name");listperiods.forEach((function(e){var index=e.getAttribute("index"),monthsElement=document.querySelector("#inputPeriodMonth".concat(index));monthsElement&&""==monthsElement.value||parseInt(monthsElement.value)}))})),addcourses.classList.remove("d-block"),addcourses.classList.add("d-none"),listcoursesplan.classList.remove("d-block"),listcoursesplan.classList.add("d-none"),listusersplan.classList.remove("d-block"),listusersplan.classList.add("d-none"))}));case 21:notperiod&&notperiod.addEventListener("click",(function(){careerduration.disabled=!1,parent.innerHTML="",parent_enrol.innerHTML="",addingperiods.disabled=!0,addcourses.classList.remove("d-none"),addcourses.classList.add("d-block"),listcoursesplan.classList.remove("d-none"),listcoursesplan.classList.add("d-block"),listusersplan.classList.remove("d-none"),listusersplan.classList.add("d-block")}));case 22:case"end":return _context5.stop()}}),_callee5)}))),function(_x4,_x5){return _ref6.apply(this,arguments)}),setTypeEnrol=function(type_enrol_manual,type_enrol_automatic){return type_enrol_manual&&type_enrol_manual.checked?1:type_enrol_automatic&&type_enrol_automatic.checked?2:0}}));

//# sourceMappingURL=create_learningplan.min.js.map